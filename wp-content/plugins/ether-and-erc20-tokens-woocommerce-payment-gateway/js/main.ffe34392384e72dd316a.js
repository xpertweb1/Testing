(self.webpackChunkether_and_erc20_tokens_woocommerce_payment_gateway=self.webpackChunkether_and_erc20_tokens_woocommerce_payment_gateway||[]).push([[179],{97072:function(e,t,n){"use strict";var a=n(98135),r=n.n(a),o=(n(28594),n(35666),n(67294)),l=n(73935),i=(n(82772),n(66992),n(64765),n(23123),n(33948),n(59713)),s=n.n(i),c=n(48926),u=n.n(c),d=n(41120),p=n(41749),m=n(22318),f=n(79895),g=n(81395),v=n(21727),h=n(72063),y=(0,d.Z)((e=>({root:{padding:e.spacing(3,2)},leftIcon:{marginRight:e.spacing(1),float:"left"},rightIcon:{marginLeft:e.spacing(1)},message:{marginBottom:"0px!important"}})));function w(e){var{message:t,type:n}=e,a=y();return r()(f.Z,{className:a.root,role:"alert"},void 0,function(e){var t=y();switch(e){case"success":return r()(g.Z,{className:t.leftIcon,"aria-hidden":"true"});case"warning":return r()(v.Z,{className:t.leftIcon,"aria-hidden":"true"});case"danger":return r()(h.Z,{className:t.leftIcon,"aria-hidden":"true"});default:throw Error("Unknown type: "+e)}return null}(n),r()(m.Z,{variant:"body1",className:a.message,component:"p"},void 0,t))}var _=n(43337),b=n(3283),x=n.n(b),H={1:null,3:null,4:null,56:null,97:null,1851060726:new Date("2020-10-20T00:00:00"),1981:new Date("2022-04-05T00:00:00")},k=null;function Z(){return V.apply(this,arguments)}function V(){return(V=u()((function*(){if(k)try{var e=yield k.eth.net.getId();null!==e&&""!==e||(console.log("Empty network ID"),k=null)}catch(e){console.log(e),k=null}if(k)return k;if("undefined"!=typeof window&&void 0!==window.ethereum&&"function"==typeof window.ethereum.enable)return window.ethereum.enable().then(function(){var e=u()((function*(e){var t=window.ethereum,n=new(x())(t),a=yield n.eth.net.getId();return void 0!==H[a]&&(null===H[a]||new Date<H[a])&&(k=n),k}));return function(t){return e.apply(this,arguments)}}()).catch((e=>(e&&console.log("User denied or ignored account access: ",e),null)));if("undefined"!=typeof window&&void 0!==window.web3){var t=window.web3.currentProvider,n=new(x())(t),a=yield n.eth.net.getId();return void 0!==H[a]&&(null===H[a]||new Date<H[a])&&(k=n),k}return console.log("No dapp browser"),null}))).apply(this,arguments)}var C=null;function S(){return T.apply(this,arguments)}function T(){return(T=u()((function*(){if(C)try{var e=yield C.eth.net.getId();null!==e&&""!==e||(console.log("Empty network ID"),C=null)}catch(e){console.log(e),C=null}if(!C){if(void 0!==window.epg.web3Endpoint){var t=new(x())(new(x().providers.WebsocketProvider)(window.epg.web3Endpoint)),n=yield t.eth.net.getId();return console.log("getWEB3: netId=",n,H),void 0!==H[n]&&(null===H[n]||new Date<H[n])&&(console.log("getWEB3: initialized"),C=t),C}throw Error("No web3 endpoint specified")}return C}))).apply(this,arguments)}function N(e,t){return O.apply(this,arguments)}function O(){return(O=u()((function*(e,t){return null!==e&&(null!==t&&(yield t.eth.net.getId())!==(yield e.eth.net.getId()))}))).apply(this,arguments)}function M(){var[e,t]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{(function(){var e=u()((function*(){var e=yield S();if(null!==e){var n=yield Z();null!==n&&t(yield N(e,n))}}));return function(){return e.apply(this,arguments)}})()()})),e}var P=n(8975),I=(0,d.Z)((e=>({root:{padding:e.spacing(3,2)},leftIcon:{marginRight:e.spacing(1),float:"left"},rightIcon:{marginLeft:e.spacing(1)},message:{marginBottom:"0px!important"}})));function A(e){var{str_metamask_network_mismatch:t,str_metamask_network_mismatch_detailed:n}=window.epg,[a,l]=(0,o.useState)(t),{paymentMethod:i}=e,s=I(),c=M();return(0,_.Z)((()=>{"metamask"!==i&&"trust"!==i||u()((function*(){var e=yield S();if(null!==e){var t=yield Z();if(null!==t){var a=yield e.eth.net.getNetworkType(),r=yield t.eth.net.getNetworkType();l((0,P.sprintf)(n,r,a))}}}))()}),5e3),c?r()(f.Z,{className:s.root,role:"alert"},void 0,r()(h.Z,{className:s.leftIcon,"aria-hidden":"true"}),r()(m.Z,{variant:"body1",className:s.message,component:"p"},void 0,a)):null}n(41817);var j=n(18463),B=n(89738),E=n(51907),D=n(79912),F=n(951),L=n(282),U=n(9248),R=n(77315),W=n(44080),z=(0,d.Z)((e=>({card:{width:"100%"},media:{height:140},button:{margin:e.spacing(1)},leftIcon:{marginRight:e.spacing(1)},rightIcon:{marginLeft:e.spacing(1)},iconSmall:{fontSize:20},description:{marginBottom:"0px!important",textTransform:"none!important",whiteSpace:"normal!important",wordBreak:"break-word!important"},accountAddress:{marginBottom:"0px!important",textTransform:"none!important"},title:{}})));function q(e){var{paymentMethodSelected:t,account:n,clearPaymentMethod:a,value:l}=e,i=t===l.mnemonic,s=z(),{baseURL:c,str_payment_method_card_connect_button_label:u,str_payment_method_card_disconnect_button_label:d}=window.epg;return r()(j.Z,{className:s.card},void 0,r()(B.Z,{onClick:i?a:l.action},void 0,r()(F.Z,{className:s.media,image:"".concat(c,"/img/").concat(l.image),title:l.title}),r()(D.Z,{},void 0,r()(m.Z,{className:s.title,gutterBottom:!0,variant:"h5",component:"h2"},void 0,l.title),function(e,t,n,a){return e?r()(o.Fragment,{},void 0,r()(m.Z,{variant:"h6",component:"h3"},void 0,window.epg.str_payment_method_card_account_label),r()(m.Z,{variant:"subtitle1",className:t.accountAddress,component:"p"},void 0,a)):r()(m.Z,{className:t.description,variant:"subtitle1",color:"textSecondary",component:"p"},void 0,n)}(i,s,l.description,n))),r()(E.Z,{},void 0,i?function(e,t,n){if(!e)return null;if(!t)return null;var a=z();return r()(L.Z,{variant:"contained",color:"primary",className:a.button,onClick:n},void 0,t,r()(W.Z,{className:a.rightIcon}))}(l.available,d,a):function(e,t,n){if(!e)return null;if(!t)return null;var a=z();return r()(L.Z,{variant:"contained",color:"primary",className:a.button,onClick:n},void 0,t,r()(R.Z,{className:a.rightIcon}))}(l.available,u,l.action),function(e){var t=e.downloadTitle,n=e.downloadURL;if(e.available)return null;if(!t)return null;var a=z();return r()(L.Z,{variant:"contained",color:"primary",className:a.button,href:n,target:"_blank"},void 0,t,r()(U.Z,{className:a.rightIcon}))}(l)))}var J=n(67154),G=n.n(J),X=n(6479),Y=n.n(X),K=n(48623),Q=n(66083),$=n(80366),ee=n(17812),te=n(29525),ne=n(7212),ae=n(66856),re=n(39803),oe=n(10637),le=n(47298),ie=n(62087),se=n(81376),ce=(0,d.Z)((e=>({dialog:{},dialogTitle:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500],boxShadow:"none"},dialogContent:{padding:e.spacing(2)},dialogActions:{margin:0,padding:e.spacing(1)},paperScrollPaper:{},button:{},scanButton:{margin:e.spacing(1),marginRight:"0px",padding:e.spacing(1),minWidth:"inherit!important"},leftIcon:{marginRight:e.spacing(1)},rightIcon:{marginLeft:e.spacing(1)},iconSmall:{fontSize:20}}))),ue=r()(ie.Z,{},void 0,r()("path",{d:"M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H11V13H9V11M15,11H17V13H19V11H21V13H19V15H21V19H19V21H17V19H13V21H11V17H15V15H17V13H15V11M19,19V15H17V19H19M15,3H21V9H15V3M17,5V7H19V5H17M3,3H9V9H3V3M5,5V7H7V5H5M3,15H9V21H3V15M5,17V19H7V17H5Z"}));var de=r()($.Z,{});function pe(e){var t=ce(),{onClose:n,onChange:a,value:l}=e,i=Y()(e,["onClose","onChange","value"]),[s,c]=(0,o.useState)(l),[d,p]=(0,o.useState)(!1),f=()=>{d?p(!1):a(s)},g=()=>{d?p(!1):n()},v=function(){var e=u()((function*(e){(yield S()).utils.isAddress(e)?(c(e),p(!1)):console.log("handleScan isAddress NOT OK:",e)}));return function(t){return e.apply(this,arguments)}}();return o.createElement(K.Z,G()({classes:{root:t.dialog,scrollBody:t.dialog,paper:t.dialog,paperScrollPaper:t.paperScrollPaper},fullWidth:!0,maxWidth:"sm",onClose:g,"aria-labelledby":"account-dialog-title"},i),r()(Q.Z,{id:"account-dialog-title",disableTypography:!0,classes:{root:t.dialogTitle}},void 0,r()(m.Z,{variant:"h6"},void 0,window.epg.str_account_dlg_title),r()(ee.Z,{"aria-label":"close",className:t.closeButton,onClick:g},void 0,de)),r()(te.Z,{dividers:!0,classes:{root:t.dialogContent}},void 0,function(e,t,n,a,l,i,s,c,u){if(l)return r()(se.Z,{delay:i,className:u.qrReader,onError:s,onScan:c});var{str_account_dlg_content:d,str_account_dlg_address_field_label:p,str_account_dlg_qrcode_button_label:m}=window.epg;return r()(o.Fragment,{},void 0,r()(ne.Z,{},void 0,d),r()(re.Z,{id:"account-address",label:p,value:e,className:u.textField,autoFocus:!0,margin:"dense",variant:"standard",fullWidth:!0,onChange:t,onKeyDown:e=>{13===e.keyCode&&n()},InputProps:{endAdornment:r()(L.Z,{onClick:()=>{a(!0)},size:"small",variant:"contained",color:"secondary","aria-label":m,title:m,classes:{root:u.scanButton}},void 0,ue)}}))}(s,(e=>{c(e.target.value)}),f,p,d,500,(e=>{console.log(e)}),v,t)),r()(ae.Z,{classes:{root:t.dialogActions}},void 0,function(e,t,n){var{str_account_dlg_ok_button_label:a,str_account_dlg_cancel_button_label:o}=window.epg;return t?r()(L.Z,{variant:"contained",color:"primary",className:n.button,onClick:e},void 0,r()(m.Z,{variant:"button"},void 0,o),r()(le.Z,{className:n.rightIcon})):r()(L.Z,{variant:"contained",color:"primary",className:n.button,onClick:e},void 0,r()(m.Z,{variant:"button"},void 0,a),r()(oe.Z,{className:n.rightIcon}))}(f,d,t)))}var me=(0,d.Z)((e=>({root:{}})));function fe(e){var{paymentMethod:t,account:n,clearPaymentMethod:a,payment_methods:l,accountDialogOpen:i,onAccountDialogClose:s,onAccountDialogChange:c}=e,u=me();return r()(o.Fragment,{},void 0,r()(pe,{value:null!==n?n:"",open:i,onClose:s,onChange:c}),r()(p.Z,{container:!0,justify:"center",className:u.root,spacing:2},void 0,l.filter((e=>null===t||e.mnemonic===t)).map((e=>r()(p.Z,{xs:12,sm:6,item:!0},e.mnemonic,r()(q,{paymentMethodSelected:t,clearPaymentMethod:a,account:n,value:e}))))))}n(56977);var ge=n(43700),ve=n(46479),he=n(30585),ye=n(64436),we=n(21473),_e=(n(88674),n(39714),n(36639)),be=(0,d.Z)((e=>({dialog:{minWidth:256},dialogTitle:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500],boxShadow:"none"},dialogContent:{padding:e.spacing(2)},dialogActions:{margin:0,padding:e.spacing(1)},paperScrollPaper:{},button:{}}))),xe=r()($.Z,{});function He(e){var t=be(),{title:n,message:a,actionText:o,onClose:l,open:i}=e,{str_alert_dlg_title_default:s,str_alert_dlg_ok_button_label:c}=window.epg;return r()(K.Z,{"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",open:i,onClose:l,classes:{root:t.dialog,scrollBody:t.dialog,paper:t.dialog,paperScrollPaper:t.paperScrollPaper}},void 0,r()(Q.Z,{id:"alert-dialog-title",disableTypography:!0,classes:{root:t.dialogTitle}},void 0,r()(m.Z,{variant:"h6"},void 0,n||s),r()(ee.Z,{"aria-label":"close",className:t.closeButton,onClick:l},void 0,xe)),r()(te.Z,{},void 0,r()(ne.Z,{id:"alert-dialog-description"},void 0,a)),r()(ae.Z,{},void 0,r()(L.Z,{onClick:l,variant:"contained",color:"primary",className:t.button,autoFocus:!0},void 0,o||c)))}var ke="0x0000000000000000000000000000000000000001",Ze="0x0000000000000000000000000000000000000000";function Ve(e){if(null===e)return null;var{base_currency_ticker:t,tokens_supported:n}=window.epg;if(ke===e)return{symbol:t,address:ke,rate:1};if(""===n)return null;for(var a=n.split(","),r=0;r<a.length;r++){var o=a[r].split(":");if(!(o.length<3)){var l=o[0],i=o[1],s=o[2];if(i.toLowerCase()===e.toLowerCase())return{symbol:l,address:i,rate:s}}}return null}function Ce(e){return parseFloat(e)*(100+parseFloat(window.epg.markup_percent_token))/(100+parseFloat(window.epg.markup_percent))}function Se(e,t){var[n,a]=(0,o.useState)(null);return(0,o.useEffect)((()=>{if(null!==t){var n=t.address;a(ke===n?e:0)}})),n}n(47042);function Te(e,t,n){return Ne.apply(this,arguments)}function Ne(){return(Ne=u()((function*(e,t,n){if(null===n)return!1;var a=yield n.eth.getCode(e),r=n.eth.abi.encodeFunctionSignature(t);return a.indexOf("63"+r.slice(2,r.length))>0}))).apply(this,arguments)}function Oe(e,t){return Me.apply(this,arguments)}function Me(){return(Me=u()((function*(e,t){if(null===t)return!1;try{return yield Te(e,"send(address,uint256,bytes)",t)}catch(e){console.log(e)}return!1}))).apply(this,arguments)}var Pe={};function Ie(e,t){return Ae.apply(this,arguments)}function Ae(){return(Ae=u()((function*(e,t){if(null===t)return!1;if(void 0!==Pe[e])return Pe[e];try{if(!Pe[e])return Pe[e]=Oe(e,t),Pe[e]}catch(e){console.log(e)}return!1}))).apply(this,arguments)}function je(e,t,n){return Be.apply(this,arguments)}function Be(){return(Be=u()((function*(e,t,n){if(null===n)return!1;var a=yield n.eth.getCode(e),r=n.eth.abi.encodeFunctionSignature(t);return a.indexOf("63"+r.slice(2,r.length))>0}))).apply(this,arguments)}var Ee={};function De(e,t){return Fe.apply(this,arguments)}function Fe(){return(Fe=u()((function*(e,t){if(null===t)return!1;if(void 0!==Ee[e])return Ee[e];try{return Ee[e]=yield je(e,"transfer(address,uint256,bytes)",t),Ee[e]}catch(e){console.log(e)}return!1}))).apply(this,arguments)}function Le(e,t,n){return Ue.apply(this,arguments)}function Ue(){return(Ue=u()((function*(e,t,n){if(null===e)return null;var a=e.address,{gateway_address:r}=window.epg;if(ke===a)return r;if(null===t)return null;if(null===n)return null;switch(t){case"deposit":return a;case"payment":return(yield Ie(a,n))||(yield De(a,n))?a:r}throw console.log("Unknown paymentStep:",t),Error("Unknown paymentStep: "+t)}))).apply(this,arguments)}function Re(e,t){var[n,a]=(0,o.useState)(null);return(0,o.useEffect)((()=>{(function(){var n=u()((function*(){var n=yield S();if(null!==n){var r=yield Le(e,t,n);null!==r&&a(r)}}));return function(){return n.apply(this,arguments)}})()()})),n}function We(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?We(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):We(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qe={};function Je(e,t){return Ge.apply(this,arguments)}function Ge(){return(Ge=u()((function*(e,t){if(null===e)return null;if(null===t)return null;var n=e.address;if(ke===n)return 18;if(void 0!==qe[n])return qe[n];var a=JSON.parse(window.epg.erc20_abi);return new t.eth.Contract(a,n).methods.decimals().call().then((function(e){return null===e?(console.log("Failed to obtain ERC20 token decimals value"),null):(qe[n]=parseInt(e),qe[n])})).catch((function(e){console.log(e)}))}))).apply(this,arguments)}function Xe(e){var[t,n]=(0,o.useState)(null),[a,r]=(0,o.useState)({});return(0,o.useEffect)((()=>{(function(){var t=u()((function*(){if(null!==e){var t=yield S();if(null!==t){var o=e.address;if(void 0===a[o]){var l=yield Je(e,t);if(null===l)return;return r(ze(ze({},a),{},{[o]:l})),void n(l)}n(a[o])}}}));return function(){return t.apply(this,arguments)}})()()})),t}var Ye=n(718);function Ke(e,t,n,a){if(null===t)return null;if(null===n)return null;var r=t.address;if(ke===r)return null;if(null===a)return null;var o=Ve(r);if(null===o)return console.log("Unsupported token rate requested"),null;var l=Ce(e)/o.rate;return(l=Math.ceil(l*10**n)/10**n)>=1e-4&&(l=Ye(l,5,"PHP_ROUND_HALF_UP")),l}function Qe(e,t,n){var[a,r]=(0,o.useState)(null);return(0,o.useEffect)((()=>{(function(){var a=u()((function*(){var a=yield S();if(null!==a){var o=Ke(e,t,n,a);null!==o&&r(o)}}));return function(){return a.apply(this,arguments)}})()()})),a}var $e=n(84956);function et(e,t,n,a){return tt.apply(this,arguments)}function tt(){return(tt=u()((function*(e,t,n,a){if(null===e)return null;if(null===t)return null;var r=e.address;if(ke===r)return null;if(null===a)return null;if((yield Ie(r,a))||(yield De(r,a)))return null;var o=JSON.parse(window.epg.erc20_abi);return new a.eth.Contract(o,r).methods.allowance(t,n).call().then((function(e){return parseInt(e)})).catch((function(e){console.log(e)}))}))).apply(this,arguments)}function nt(e,t,n,a){var[r,l]=(0,o.useState)(null),i=e,s=window.epg.gateway_address,c=function(e,t,n){var a=(0,$e.Z)(),[r,l]=(0,o.useState)(null);return(0,o.useEffect)((()=>{!function(){var r=u()((function*(){var r=yield S();if(null!==r){var o=yield et(e,t,n,r);null!==o&&a()&&l(o)}}));return function(){return r.apply(this,arguments)}}()()})),r}(n,i,s),d=Xe(n),p=Qe(t,n,d),m=function(e,t,n,a,r){var[l,i]=(0,o.useState)(null);return(0,o.useEffect)((()=>{if(null!==e){var o=e.address;ke!==o&&null!==t&&null!==n&&null!==r&&function(){var e=u()((function*(){var e=yield S();if(null!==e){var l=JSON.parse(window.epg.erc20_abi),s=new e.eth.Contract(l,o),c=0;0===r&&(c=Math.ceil(n*Math.pow(10,t)));var u="0x"+e.utils.toBN("0x"+c.toString(16)).toString("hex");i(s.methods.approve(a,u).encodeABI())}}));return function(){return e.apply(this,arguments)}}()()}})),l}(n,d,p,s,c),f=function(){var[e,t]=(0,o.useState)(null);return(0,o.useEffect)((()=>{!function(){var e=u()((function*(){var e=yield S();if(null!==e){var{gateway_abi:n,gateway_address:a,payment_address:r,addressSite:o,order_id:l,masterVendor:i,masterVendorFee:s}=window.epg,c=JSON.parse(n),u=new e.eth.Contract(c,a);Ze!==i&&0!==parseFloat(s)?t(u.methods.payEthVA(r,o,l,i,s).encodeABI()):t(u.methods.payEthA(r,o,l).encodeABI())}}));return function(){return e.apply(this,arguments)}}()()})),e}(),g=function(e,t,n){var[a,r]=(0,o.useState)(null);return(0,o.useEffect)((()=>{if(null!==e){var a=e.address;ke!==a&&null!==t&&null!==n&&function(){var e=u()((function*(){var e=yield S();if(null!==e){var{gateway_abi:o,gateway_address:l,payment_address:i,addressSite:s,order_id:c,masterVendor:u,masterVendorFee:d}=window.epg,p=JSON.parse(o),m=new e.eth.Contract(p,l),f=Math.ceil(n*Math.pow(10,t)),g="0x"+e.utils.toBN("0x"+f.toString(16)).toString("hex"),v=(yield Ie(a,e))||(yield De(a,e));Ze!==u&&0!==parseFloat(d)?r(v?m.methods.payTokenVA_Fake(i,s,c,u,d).encodeABI():m.methods.payTokenVA(a,i,s,c,g,u,d).encodeABI()):r(v?m.methods.payTokenA_Fake(i,s,c).encodeABI():m.methods.payTokenA(a,i,s,c,g).encodeABI())}}));return function(){return e.apply(this,arguments)}}()()}})),a}(n,d,p),v=function(e){var[t,n]=(0,o.useState)(null);return(0,o.useEffect)((()=>{if(null!==e){var t=e.address;ke!==t?function(){var e=u()((function*(){var e=yield S();if(null!==e){var a=yield Ie(t,e);n(a)}}));return function(){return e.apply(this,arguments)}}()():n(!1)}})),t}(n),h=function(e,t,n,a){var[r,l]=(0,o.useState)(null);return(0,o.useEffect)((()=>{if(null!==e){var r=e.address;ke!==r&&null!==t&&null!==n&&null!==a&&function(){var e=u()((function*(){var e=yield S();if(null!==e){var{gateway_address:o}=window.epg,i=JSON.parse(window.epg.erc777_abi),s=new e.eth.Contract(i,r),c=Math.ceil(n*10**t),u="0x"+e.utils.toBN("0x"+c.toString(16)).toString("hex"),d=a.substring(0,10)+"00000000000000000000000000000000000000000000000000000000"+a.substring(10),p=s.methods.send(o,u,d).encodeABI();l(p)}}));return function(){return e.apply(this,arguments)}}()()}})),r}(n,d,p,g),y=function(e){var[t,n]=(0,o.useState)(null);return(0,o.useEffect)((()=>{if(null!==e){var t=e.address;ke!==t?function(){var e=u()((function*(){var e=yield S();if(null!==e){var a=yield De(t,e);n(a)}}));return function(){return e.apply(this,arguments)}}()():n(!1)}})),t}(n),w=function(e,t,n,a){var[r,l]=(0,o.useState)(null);return(0,o.useEffect)((()=>{if(null!==e){var r=e.address;ke!==r&&null!==t&&null!==n&&null!==a&&function(){var e=u()((function*(){var e=yield S();if(null!==e){var{gateway_address:o}=window.epg,i=JSON.parse(window.epg.erc223_abi),s=new e.eth.Contract(i,r),c=Math.ceil(n*10**t),u="0x"+e.utils.toBN("0x"+c.toString(16)).toString("hex"),d=a.substring(0,10)+"00000000000000000000000000000000000000000000000000000000"+a.substring(10),p=s.methods.transfer(o,u,d).encodeABI();l(p)}}));return function(){return e.apply(this,arguments)}}()()}})),r}(n,d,p,g);return(0,o.useEffect)((()=>{if(null!==n){var e=n.address;if(ke!==e){if(null!==a)switch(a){case"deposit":l(m);break;case"payment":l(v?h:y?w:g);break;default:throw console.log("Unknown paymentStep:",a),Error("Unknown paymentStep: "+a)}}else l(f)}})),r}function at(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?at(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):at(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}n(718);var ot=(0,d.Z)((e=>({root:{width:"100%"},button:{margin:e.spacing(1),marginLeft:e.spacing(-1),width:"100%"},leftIcon:{marginRight:e.spacing(1)},rightIcon:{marginLeft:e.spacing(1)},iconSmall:{fontSize:20}})));function lt(){return(lt=u()((function*(e,t,n,a,r,o,l,i){try{var{gas_limit:s,wp_rest_nonce:c,confirmations_number:d}=window.epg,p=e,m=yield r.eth.getGasPrice(),f=1.5*parseInt(m.toString(10)),g={from:p,to:t,value:"0x"+r.utils.toBN(n).toString("hex"),data:a},v=yield r.eth.estimateGas(g);g=rt(rt({},g),{gas:"0x"+r.utils.toBN(v).toString("hex"),gasPrice:"0x"+r.utils.toBN("0x"+Math.floor(f).toString(16)).toString("hex"),nonce:"0x00"});var h=yield r.eth.getTransactionCount(p),y=parseInt(h);g.nonce="0x"+y.toString(16),console.log(g);var w=d;o.eth.sendTransaction(g).once("transactionHash",function(){var e=u()((function*(e){console.log(e),(yield dt(e))&&(yield l(e))}));return function(t){return e.apply(this,arguments)}}()).on("confirmation",(function(e,t){(e>w||e===w)&&i.call(null,null,t.transactionHash)})).on("error",(function(e){i.call(null,e,null)})).then((function(e){})).catch((function(e){i.call(null,e,null)}))}catch(e){console.log(e),i.call(null,e,null)}}))).apply(this,arguments)}function it(e,t){return 0===e.length?e:(e.charAt(0)===t&&(e=e.substring(1)),0===e.length||e.charAt(e.length-1)===t&&(e=e.substring(0,e.length-1)),e)}var st=e=>Object.keys(e).map((t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]))).join("&");function ct(){return(ct=u()((function*(e,t,n,a,r,o){try{var{user_wallet_address:l,gas_limit:i,wp_rest_nonce:s,wp_rest_url:c,confirmations_number:d}=window.epg,p=l,m=yield a.eth.getGasPrice(),f=1.5*parseInt(m.toString(10)),g={from:p,to:e,value:"0x"+a.utils.toBN(t).toString("hex"),data:n},v=yield a.eth.estimateGas(g);g=rt(rt({},g),{gas:"0x"+a.utils.toBN(v).toString("hex"),gasPrice:"0x"+a.utils.toBN("0x"+Math.floor(f).toString(16)).toString("hex"),nonce:"0x00"});var h=yield a.eth.getTransactionCount(p),y=parseInt(h);g.nonce="0x"+y.toString(16),console.log(g);var w=s,_=yield fetch(c+"ethereumwallet/v1/web3_signTransaction",{method:"POST",headers:{Accept:"text/plain","Content-type":"application/x-www-form-urlencoded"},dataType:"text",body:st(rt(rt({},g),{},{_wpnonce:w}))});if(null===_||'""'===_)return console.error("ethereum_wallet_signTransaction error: empty result"),void o.call(null,"empty result",null);var b=yield _.text();if('""'===b)return console.error("ethereum_wallet_signTransaction error: empty result"),void o.call(null,"empty result",null);var x=it(b,'"');console.log("txRawSigned:",x);var H=d;a.eth.sendSignedTransaction(x).once("transactionHash",function(){var e=u()((function*(e){console.log(e),(yield dt(e))&&(yield r(e))}));return function(t){return e.apply(this,arguments)}}()).on("confirmation",(function(e,t){(e>H||e===H)&&o.call(null,null,t.transactionHash)})).on("error",(function(e){o.call(null,e,null)})).then((function(e){})).catch((function(e){o.call(null,e,null)}))}catch(e){console.log(e),o.call(null,e,null)}}))).apply(this,arguments)}var ut={};function dt(e){return pt.apply(this,arguments)}function pt(){return(pt=u()((function*(e){if(void 0!==ut[e])return!0;try{var{order_id:t,save_order_txhash_nonce:n,wpj_payment_type:a}=window.epg;yield fetch("/",{method:"POST",headers:{Accept:"text/plain","Content-type":"application/x-www-form-urlencoded"},dataType:"text",body:st({txhash:e,order_id:t,save_order_txhash_nonce:n,action:"save_order_txhash",wpj_payment_type:a})});return window.history.replaceState&&window.history.replaceState(null,null,window.location.href),ut[e]=!0,!0}catch(e){return console.log(e),!1}}))).apply(this,arguments)}var mt={};function ft(){return gt.apply(this,arguments)}function gt(){return(gt=u()((function*(){try{var{order_id:e,save_order_txhash_nonce:t,wpj_payment_type:n}=window.epg;if(void 0!==mt[e+""+n])return!0;yield fetch("/",{method:"POST",headers:{Accept:"text/plain","Content-type":"application/x-www-form-urlencoded"},dataType:"text",body:st({order_id:e,save_order_txhash_nonce:t,action:"update_confirmed_status",wpj_payment_type:n})});return window.history.replaceState&&window.history.replaceState(null,null,window.location.href),mt[e+""+n]=!0,!0}catch(e){return console.log(e),!1}}))).apply(this,arguments)}function vt(e){var t=ot(),[n,a]=(0,o.useState)(!1),[l,i]=(0,o.useState)(""),{paymentMethod:s,paymentMethods:c,paymentStep:d,account:m,etherAmount:f,currency:g,changeLastTxHash:v,amount:h,balance:y}=e;if(!c.filter((e=>e.mnemonic===s))[0].hasWalletAccess)return null;var{str_payment_failed:w,str_pay_button_label:_,str_deposit_button_label:b,str_alert_dlg_title:x}=window.epg,H=Se(f,g),k=Re(g,d),V=nt(m,f,g,d),C=function(){var e=u()((function*(e){switch(e.preventDefault(),s){case"metamask":case"trust":var t=yield S();if(null===t)break;var n=yield Z();if(null===n)break;if(yield N(t,n))break;yield function(e,t,n,a,r,o,l,i){return lt.apply(this,arguments)}(m,k,Math.floor(1e18*H),V,t,n,v,((e,t)=>{if(e)return console.log(e),i(w),void a(!0)}));break;case"ethereum_wallet":var r=yield S();if(null===r)break;yield function(e,t,n,a,r,o){return ct.apply(this,arguments)}(k,Math.floor(1e18*H),V,r,v,((e,t)=>{if(e)return console.log(e),i(w),void a(!0)}));break;case"qr":break;default:console.log("Unknown paymentMethod:",s)}}));return function(t){return e.apply(this,arguments)}}(),T=function(e,t){var{str_pay_button_label:n,str_deposit_button_label:a}=window.epg,[r,l]=(0,o.useState)(n);return(0,o.useEffect)((()=>{if(null!==e){var r=e.address;if(ke!==r){if(null!==t&&ke!==r)switch(t){case"deposit":l(a);break;case"payment":l(n);break;default:throw console.log("Unknown paymentStep:",t),Error("Unknown paymentStep: "+t)}}else l(n)}})),r}(g,d),O=y<h;return r()(o.Fragment,{},void 0,r()(He,{title:x,message:l,open:n,onClose:()=>{a(!1)}}),r()(p.Z,{className:t.root,container:!0,direction:"row-reverse"},void 0,r()(p.Z,{xs:12,sm:3,item:!0},void 0,r()(L.Z,{variant:"contained",disabled:O,color:"primary",className:t.button,onClick:C},void 0,T,r()(_e.Z,{className:t.rightIcon})))))}var ht=n(89659),yt=n(718);var wt=n(34424),_t=(0,d.Z)((e=>({root:{padding:e.spacing(3,2)},content:{},row:{},item:{},control:{padding:e.spacing(2)},button:{margin:e.spacing(1)},formControl:{width:"100%"},selectEmpty:{marginTop:e.spacing(2)},helperText:{marginBottom:"0px!important"},amount:{marginBottom:"0px!important"},balance:{marginBottom:"0px!important"},product:{marginBottom:"0px!important"},link:{}})));function bt(e){var{currency:t,account:n,currencies:a,changePaymentCurrency:l,changeLastTxHash:i,paymentMethod:s,paymentMethods:c,paymentStep:d}=e,{eth_value:g}=window.epg,{str_payment_currency_selector_currency_label:v,str_payment_currency_selector_balance_value_default:h,str_payment_currency_selector_currency_helper_text:y,str_payment_currency_selector_amount_label:w}=window.epg,_=function(e,t){var[n,a]=(0,o.useState)(null),r=Xe(t),l=Qe(e,t,r);return(0,o.useEffect)((()=>{if(null!==t){var n=t.address;a(ke===n?e:l)}})),n}(parseFloat(g),t),b=function(e,t){var n=(0,$e.Z)(),[a,r]=(0,o.useState)(null),l=Xe(t);return(0,o.useEffect)((()=>{null!==e&&null!==t&&function(){var a=u()((function*(){var a=yield S();if(null!==a){var o=t.address;if(ke===o)a.eth.getBalance(e,((e,t)=>{if(e)console.log(e);else{var a=parseInt(t)/1e18;a>=1e-4&&(a=yt(a,5,"PHP_ROUND_HALF_DOWN")),n()&&r(a)}}));else{var i=JSON.parse(window.epg.erc20_abi);new a.eth.Contract(i,o).methods.balanceOf(e).call().then((function(e){var t=parseInt(e)/Math.pow(10,l);t>=1e-4&&(t=yt(t,5,"PHP_ROUND_HALF_DOWN")),n()&&r(t)})).catch((function(e){console.log(e)}))}}}));return function(){return a.apply(this,arguments)}}()()})),a}(n,t),x=M(),H=_t();if(x)return null;var k=null===_?"":wt(wt(wt(_.toFixed(t.decimals||5),"0"),"."),",");return r()(f.Z,{className:H.root},void 0,r()(p.Z,{container:!0,spacing:2,className:H.content},void 0,r()(p.Z,{item:!0,xs:12,className:H.row},void 0,r()(ye.Z,{required:!0,className:H.formControl},void 0,r()(ge.Z,{htmlFor:"currency"},void 0,v),r()(we.Z,{value:t?t.symbol:"",onChange:l,name:"currency",inputProps:{id:"currency"},className:H.selectEmpty},void 0,a.map((e=>r()(ve.Z,{value:e.symbol},e.symbol,e.symbol)))),r()(he.Z,{className:H.helperText},void 0,y))),r()(p.Z,{container:!0,item:!0,xs:12,spacing:2,className:H.row},void 0,r()(p.Z,{item:!0,xs:12,sm:6,className:H.item},void 0,r()(m.Z,{variant:"h5",component:"h3"},void 0,w),r()(m.Z,{variant:"body1",className:H.amount,component:"p"},void 0,k," ",t.symbol)),r()(p.Z,{item:!0,xs:12,sm:6,className:H.item},void 0,function(e,t,n,a,l){var{token2wcproduct:i,str_payment_currency_selector_balance_label:s,str_payment_currency_selector_balance_value_default:c,str_purchase_tokens_button_text:u,str_purchase_ether_button_text:d}=window.epg;if(null===e)return r()(o.Fragment,{},void 0,r()(m.Z,{variant:"h5",component:"h3"},void 0,s),r()(m.Z,{variant:"body1",className:l.balance,component:"p"},void 0,c));var p=null===t?"":wt(wt(wt(t.toFixed(a.decimals||5),"0"),"."),","),f=JSON.parse(i);if(void 0===f[a.address.toLowerCase()]||n<=t)return r()(o.Fragment,{},void 0,r()(m.Z,{variant:"h5",component:"h3"},void 0,s),r()(m.Z,{variant:"body1",className:l.balance,component:"p"},void 0,p," ",a.symbol));var g=d;return ke!==a.address&&(g=(0,P.sprintf)(u,a.symbol)),r()(o.Fragment,{},void 0,r()(m.Z,{variant:"h5",component:"h3"},void 0,s),r()(m.Z,{variant:"body1",className:l.balance,component:"p"},void 0,p," ",a.symbol),r()(m.Z,{variant:"body2",className:l.product,component:"p"},void 0,r()(ht.Z,{href:f[a.address.toLowerCase()],target:"_blank",className:l.link},void 0,g)))}(n,b,_,t,H))),r()(p.Z,{item:!0,xs:12,className:H.row},void 0,r()(vt,{paymentMethod:s,paymentMethods:c,paymentStep:d,account:n,etherAmount:g,currency:t,amount:_,balance:b,changeLastTxHash:i}))))}var xt=n(15733),Ht=n(74965),kt=n(68479),Zt=n(64566),Vt=n(74855),Ct=n(87239),St=n(24837),Tt=(n(45697),n(14670)),Nt=n(79361),Ot=n.n(Nt),Mt=r()($.Z,{});var Pt=(0,Tt.Z)((e=>({grid:{overflowX:"inherit",overflowY:"inherit"},dialog:{overflowX:"inherit",overflowY:"inherit"},dialogTitle:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500],boxShadow:"none"},dialogContent:{padding:e.spacing(2),overflowX:"hidden",overflowY:"hidden"},paperScrollPaper:{height:"328px"}})))((function(e){var{classes:t,onClose:n,value:a}=e,l=Y()(e,["classes","onClose","value"]);return""===a?null:o.createElement(K.Z,G()({classes:{root:t.dialog,scrollBody:t.dialog,paper:t.dialog,paperScrollPaper:t.paperScrollPaper},fullWidth:!0,maxWidth:"xs",onClose:n,"aria-labelledby":"qrcode-dialog-title"},l),r()(Q.Z,{id:"qrcode-dialog-title",disableTypography:!0,classes:{root:t.dialogTitle}},void 0,r()(m.Z,{variant:"h6"},void 0,window.epg.str_qrcode_dlg_title),r()(ee.Z,{"aria-label":"close",className:t.closeButton,onClick:n},void 0,Mt)),r()(te.Z,{dividers:!0,classes:{root:t.dialogContent}},void 0,r()(p.Z,{container:!0,className:t.grid,alignItems:"center",direction:"row",justify:"center"},void 0,r()(Ot(),{value:a,title:a,size:235,includeMargin:!1}))))})),It=(0,d.Z)((e=>({root:{width:"100%"},heading:{fontSize:e.typography.pxToRem(15),flexBasis:"33.33%",flexShrink:0,marginBottom:"0px!important"},secondaryHeading:{fontSize:e.typography.pxToRem(15),color:e.palette.text.secondary,marginBottom:"0px!important"},textField:{width:"100%"},button:{margin:e.spacing(1),marginRight:"0px",padding:e.spacing(1),minWidth:"inherit!important"},buttonGroup:{width:"100%"}})));function At(e,t){var{str_payment_step_unknown:n,str_payment_step_ether_payment:a,str_payment_step_token_deposit:r,str_payment_step_token_payment:o}=window.epg,l=n,i=e.address;if(ke===i)l=a;else if(null!==t)switch(t){case"deposit":l=r;break;case"payment":l=o;break;default:throw console.log("Unknown paymentStep:",t),Error("Unknown paymentStep: "+t)}return l}var jt=r()(Zt.Z,{}),Bt=r()(Ct.Z,{}),Et=r()(ie.Z,{},void 0,r()("path",{d:"M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H11V13H9V11M15,11H17V13H19V11H21V13H19V15H21V19H19V21H17V19H13V21H11V17H15V15H17V13H15V11M19,19V15H17V19H19M15,3H21V9H15V3M17,5V7H19V5H17M3,3H9V9H3V3M5,5V7H7V5H5M3,15H9V21H3V15M5,17V19H7V17H5Z"})),Dt=r()(Ct.Z,{}),Ft=r()(ie.Z,{},void 0,r()("path",{d:"M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H11V13H9V11M15,11H17V13H19V11H21V13H19V15H21V19H19V21H17V19H13V21H11V17H15V15H17V13H15V11M19,19V15H17V19H19M15,3H21V9H15V3M17,5V7H19V5H17M3,3H9V9H3V3M5,5V7H7V5H5M3,15H9V21H3V15M5,17V19H7V17H5Z"})),Lt=r()(Ct.Z,{}),Ut=r()(ie.Z,{},void 0,r()("path",{d:"M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H11V13H9V11M15,11H17V13H19V11H21V13H19V15H21V19H19V21H17V19H13V21H11V17H15V15H17V13H15V11M19,19V15H17V19H19M15,3H21V9H15V3M17,5V7H19V5H17M3,3H9V9H3V3M5,5V7H7V5H5M3,15H9V21H3V15M5,17V19H7V17H5Z"}));function Rt(e){var{account:t,etherAmount:n,currency:a,paymentStep:l,expandedInitial:i}=e,s=Se(n,a),c=Re(a,l),u=nt(t,n,a,l),d=M(),f=It(),[g,v]=(0,o.useState)(i),[h,y]=(0,o.useState)(!1),[w,_]=(0,o.useState)(""),[b,x]=(0,o.useState)(!1),[H,k]=(0,o.useState)("");if(d)return null;var{str_copied_to_clipboard:Z,str_advanced_panel_title:V,str_advanced_panel_desc:C,str_payment_step_label:S,str_advanced_panel_address_label:T,str_copy_to_clipboard:N,str_advanced_panel_qrcode_button_label:O,str_advanced_panel_value_label:P,str_advanced_panel_data_label:I}=window.epg;return r()(o.Fragment,{},void 0,r()(He,{title:Z,message:H,open:b,onClose:()=>{x(!1)}}),r()(Pt,{value:w,open:h,onClose:()=>{y(!1)}}),r()(xt.Z,{className:f.root,expanded:g,onChange:(e,t)=>{v(t)}},void 0,r()(kt.Z,{expandIcon:jt,"aria-controls":"advancedbh-content",id:"advancedbh-header"},void 0,r()(m.Z,{variant:"h3",className:f.heading},void 0,V),r()(m.Z,{variant:"h4",className:f.secondaryHeading},void 0,C)),r()(Ht.Z,{},void 0,r()(p.Z,{container:!0,className:f.content},void 0,r()(p.Z,{item:!0,xs:12,className:f.row},void 0,r()(re.Z,{id:"epg-payment-step-message",label:S,value:At(a,l),className:f.textField,margin:"dense",InputProps:{readOnly:!0}})),r()(p.Z,{item:!0,xs:12,className:f.row},void 0,r()(re.Z,{id:"epg-to-address",label:T,value:null!==c?c:"",className:f.textField,margin:"dense",variant:"standard",InputProps:{readOnly:!0,endAdornment:r()(St.Z,{},void 0,r()(Vt.CopyToClipboard,{text:null!==c?c:"",onCopy:()=>{x(!0),k(null!==c?""+c:"")}},void 0,r()(L.Z,{size:"small",variant:"contained",color:"secondary","aria-label":N,title:N,classes:{root:f.button}},void 0,Bt)),r()(L.Z,{onClick:()=>{y(!0),_(null!==c?""+c:"")},size:"small",variant:"contained",color:"secondary","aria-label":O,title:O,classes:{root:f.button}},void 0,Et))}})),r()(p.Z,{item:!0,xs:12,className:f.row},void 0,r()(re.Z,{id:"epg-value",label:P,value:null!==s?s:"",className:f.textField,margin:"dense",variant:"standard",InputProps:{readOnly:!0,endAdornment:r()(St.Z,{},void 0,r()(Vt.CopyToClipboard,{text:null!==s?s:"",onCopy:()=>{x(!0),k(null!==s?""+s:"")}},void 0,r()(L.Z,{size:"small",variant:"contained",color:"secondary","aria-label":N,title:N,classes:{root:f.button}},void 0,Dt)),r()(L.Z,{onClick:()=>{y(!0),_(null!==s?""+s:"")},size:"small",variant:"contained",color:"secondary","aria-label":O,title:O,classes:{root:f.button}},void 0,Ft))}})),r()(p.Z,{item:!0,xs:12,className:f.row},void 0,r()(re.Z,{id:"epg-data",label:I,value:null!==u?u:"",className:f.textField,multiline:!0,rowsMax:"4",margin:"dense",variant:"standard",InputProps:{readOnly:!0,endAdornment:r()(St.Z,{},void 0,r()(Vt.CopyToClipboard,{text:null!==u?u:"",onCopy:()=>{x(!0),k(null!==u?""+u:"")}},void 0,r()(L.Z,{size:"small",variant:"contained",color:"secondary","aria-label":N,title:N,classes:{root:f.button}},void 0,Lt)),r()(L.Z,{onClick:()=>{y(!0),_(null!==u?""+u:"")},size:"small",variant:"contained",color:"secondary","aria-label":O,title:O,classes:{root:f.button}},void 0,Ut))}}))))))}var Wt=n(43832),zt=n(95477),qt=(0,d.Z)((e=>({dialog:{overflowX:"hidden",overflowY:"hidden"},dialogTitle:{margin:0,padding:e.spacing(2)},dialogContent:{padding:e.spacing(2),overflowX:"hidden",overflowY:"hidden"},paperScrollPaper:{overflowX:"hidden",overflowY:"hidden"},grid:{overflowX:"hidden",overflowY:"hidden"},progress:{margin:e.spacing(2)},link:{}}))),Jt=window.epg.confirmations_number||12;var Gt=function(e){var t=qt(),{lastTxHash:n,lastTxConfirmations:a}=e,l=Y()(e,["lastTxHash","lastTxConfirmations"]),i=!1,s=0;null!==a&&(i=(s=a)<Jt);var c=s+"/"+Jt,{str_tx_progress_dlg_title:u,str_tx_progress_dlg_content:d}=window.epg,f=function(e){if(null===e)return null;var{blockchain_network:t,view_transaction_url:n}=window.epg;if(""!==n)return(0,P.sprintf)(n,e);var a="";return"mainnet"!==t&&(a=t+"."),"https://"+a+"etherscan.io/tx/"+e}(n);return o.createElement(K.Z,G()({classes:{root:t.dialog,scrollBody:t.dialog,paper:t.dialog,paperScrollPaper:t.paperScrollPaper},open:i,maxWidth:"sm","aria-labelledby":"tx-progress-dialog-title"},l),r()(Q.Z,{id:"tx-progress-dialog-title",disableTypography:!0,classes:{root:t.dialogTitle}},void 0,r()(m.Z,{variant:"h6"},void 0,u)),r()(te.Z,{dividers:!0,classes:{root:t.dialogContent}},void 0,r()(p.Z,{container:!0,className:t.grid,alignItems:"center",direction:"row",justify:"center"},void 0,r()(zt.Z,{className:t.progress})),r()(Wt.Z,{maxWidth:"sm"},void 0,r()(m.Z,{variant:"body1",component:"p"},void 0,(0,P.sprintf)(d,c)),r()(m.Z,{variant:"body2",component:"p"},void 0,r()(ht.Z,{href:f,target:"_blank",className:t.link},void 0,n)))))};function Xt(e){var{blockchain_network:t}=window.epg,n="";return"mainnet"!==t&&(n="-"+t),"https://api"+n+".etherscan.io/api?module=account&action=txlist&address="+e+"&startblock=0&endblock=99999999&sort=desc"}function Yt(e){return Kt.apply(this,arguments)}function Kt(){return(Kt=u()((function*(e){var{order_txhash:t,blockchain_network:n}=window.epg;if(null===e)return""!==t?t:null;if(!["mainnet","ropsten","rinkeby"].includes(n))return null;var a=Xt(e);try{var r=yield fetch(a,{headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"}});if(!r.ok)return console.log(r.status),null;var o=yield r.json();if("1"!==o.status)return console.log(o.message),console.log(o.result),null;for(var l=0;l<o.result.length;l++){var i=o.result[l];if(e.toUpperCase()===i.from.toUpperCase())return i.hash}}catch(e){console.log(e)}return null}))).apply(this,arguments)}function Qt(e,t,n,a){return $t.apply(this,arguments)}function $t(){return($t=u()((function*(e,t,n,a){if(null===e)return null;if(null===n)return null;if(null===a)return null;var r=n.address;if(ke===r)return"payment";if((yield Ie(r,a))||(yield De(r,a)))return"payment";var o=e,l=window.epg.gateway_address,i=yield et(n,o,l,a),s=yield Je(n,a),c=Ke(t,n,s,a),u=Math.ceil(c*Math.pow(10,s));return 0===i||u>0&&i<u?"deposit":u>0&&i>=u?"payment":null}))).apply(this,arguments)}function en(e){return tn.apply(this,arguments)}function tn(){return(tn=u()((function*(e){if(null===e)return null;var{gateway_abi:t,gateway_address:n,payment_address:a,addressSite:r,order_id:o}=window.epg,l=JSON.parse(t),i=new e.eth.Contract(l,n);try{var s=yield i.methods.getValuePayment(a,r,o).call();return null===s?s:parseInt(s)}catch(e){console.log(e,n,a,r,o)}}))).apply(this,arguments)}function nn(e){return an.apply(this,arguments)}function an(){return(an=u()((function*(e){if(null===e)return null;var{gateway_abi:t,gateway_address:n,payment_address:a,addressSite:r,order_id:o}=window.epg,l=JSON.parse(t),i=new e.eth.Contract(l,n);try{return yield i.methods.getCurrencyPayment(a,r,o).call()}catch(e){console.log(e,n,a,r,o)}return null}))).apply(this,arguments)}var rn=n(718);function on(e,t){if(null===e)return!1;var{value:n}=window.epg,a="PHP_ROUND_HALF_UP";if(t!==ke){if(rn(e,5,a)<rn(Ce(n),5,a))return!1}else if(rn(e,5,a)<rn(n,5,a))return!1;return!0}function ln(e,t){return sn.apply(this,arguments)}function sn(){return(sn=u()((function*(e,t){if(null===t)return null;var n=yield nn(t);return null===n?(console.log("useOrderPayed currencyPayment is null"),null):on(yield cn(e,t),n)}))).apply(this,arguments)}function cn(e,t){return un.apply(this,arguments)}function un(){return(un=u()((function*(e,t){if(null===t)return null;var n=yield en(t);if(null===n)return null;var a=yield nn(t);if(null===a)return null;if(a===Ze||"0x"===a)return null;if(a===ke)return n/1e18;var r=Ve(a);if(null===r)return console.log("Failed to obtain token rate"),null;var o=yield Je(e,t);return null===o?null:r.rate*n/Math.pow(10,o)}))).apply(this,arguments)}var dn=n(13457);function pn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pn(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var fn=(0,n(93021).Z)({}),gn=(0,d.Z)((e=>({root:{flexGrow:1,padding:e.spacing(3,2)},content:{margin:"auto",maxWidth:750},row:{marginBottom:e.spacing(1)},title:{textAlign:"left"}})));function vn(){var e=window.location.href;return"https://link.trustwallet.com/open_url?coin_id=60&url="+encodeURIComponent(e)}function hn(e,t){var n,a,r,o,l,i=(n=null,"undefined"!=typeof window&&void 0!==window.ethereum?n=window.ethereum:"undefined"!=typeof window&&void 0!==window.web3&&void 0!==window.web3.currentProvider&&(n=window.web3.currentProvider),n?n.isMetaMask?"metamask":n.isTrust?"trust":n.isGoWallet?"goWallet":n.isAlphaWallet?"alphaWallet":n.isStatus?"status":n.isToshi?"coinbase":void 0!==window.__CIPHER__?"cipher":"EthereumProvider"===n.constructor.name?"mist":"Web3FrameProvider"===n.constructor.name?"parity":n.host&&-1!==n.host.indexOf("infura")?"infura":n.host&&-1!==n.host.indexOf("localhost")?"localhost":"unknown":null),{str_download_metamask:s,str_download_metamask_mobile:c,str_download_trust:u,str_trust_wallet_title:d,str_trust_wallet_desc:p,str_metamask_title:m,str_metamask_desc:f,str_ethereum_wallet_title:g,str_ethereum_wallet_desc:v,str_qrcode_title:h,str_qrcode_desc:y}=window.epg,w=[],_=(r=!1,a=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(r=!0),r),b=_?c:s,x=_?(o=window.location,l=o.host+o.pathname+o.search+o.hash,"https://metamask.app.link/dapp/"+encodeURIComponent(l)):"https://metamask.io/";return w.push({mnemonic:"metamask",image:"metamask.svg",title:m,description:f,downloadTitle:"metamask"!==i?b:null,downloadURL:"metamask"!==i?x:null,hasWalletAccess:!0,available:"metamask"===i,action:()=>{Z().then((t=>{t.eth.getAccounts(((t,n)=>{t?console.log(t):e("metamask",n)}))}))}}),_&&w.push({mnemonic:"trust",image:"trust-wallet.svg",title:d,description:p,downloadTitle:"trust"!==i?u:null,downloadURL:"trust"!==i?vn():null,available:"trust"===i,hasWalletAccess:!0,action:()=>{Z().then((t=>{t.eth.getAccounts(((t,n)=>{t?console.log(t):e("trust",n)}))}))}}),w.push({mnemonic:"qr",image:"qr.svg",title:h,description:y,downloadTitle:null,downloadURL:null,hasWalletAccess:!1,available:!0,action:t}),void 0!==window.epg.user_wallet_address&&""!==window.epg.user_wallet_address&&w.push({mnemonic:"ethereum_wallet",image:"ethereum-wallet.svg",title:g,description:v,downloadTitle:null,downloadURL:null,hasWalletAccess:!0,available:!0,action:()=>{e("ethereum_wallet",[window.epg.user_wallet_address])}}),w}function yn(e,t){if(""===t)return null;var n=e.filter((e=>e.symbol===t));if(0===n.length)throw Error("Unknown currency symbol");return n[0]}var wn={};function _n(e,t){return bn.apply(this,arguments)}function bn(){return(bn=u()((function*(e,t){if(null===e)return null;if(void 0!==wn[e])return wn[e];var n=yield t.eth.getTransactionReceipt(e);return null===n?null:(wn[e]=n,n)}))).apply(this,arguments)}function xn(e,t){return Hn.apply(this,arguments)}function Hn(){return(Hn=u()((function*(e,t){if(null===e)return null;var n=yield _n(e,t);if(null===n)return 0;var a=(yield t.eth.getBlockNumber())-n.blockNumber+1;return a>=0?a:0}))).apply(this,arguments)}function kn(e,t,n,a){return Zn.apply(this,arguments)}function Zn(){return(Zn=u()((function*(e,t,n,a){var r=a.length>0?a[0]:null,o={paymentMethod:n,account:r},l=yield Vn(mn(mn({},e),o),r);if(o=mn(mn({},o),l),t.length>0){var i=t[0].symbol,s=yield Sn(mn(mn({},e),o),t,i);o=mn(mn({},o),s)}return console.log("getPaymentMethodChangeResults:",n,a,e,o),o}))).apply(this,arguments)}function Vn(e,t){return Cn.apply(this,arguments)}function Cn(){return(Cn=u()((function*(e,t){if(null===t)return{account:t,lastTxHash:null,lastTxConfirmations:null};var n=yield Yt(t),a=yield S();return{account:t,lastTxHash:n,lastTxConfirmations:null!==n?yield xn(n,a):null}}))).apply(this,arguments)}function Sn(e,t,n){return Tn.apply(this,arguments)}function Tn(){return(Tn=u()((function*(e,t,n){var a=yn(t,n),r=yield S(),o=window.epg.eth_value;return{currency:a,paymentStep:yield Qt(e.account,o,a,r)}}))).apply(this,arguments)}function Nn(){return(Nn=u()((function*(e,t,n,a){var r=yield S(),o=void 0===a?yield xn(t,r):a;console.log("getLastTxHashChangeResults: lastTxConfirmations:",o);var l=yield On(mn(mn({},e),{},{lastTxHash:t}),o,n);return mn({lastTxConfirmations:o},l)}))).apply(this,arguments)}function On(e,t,n){return Mn.apply(this,arguments)}function Mn(){return(Mn=u()((function*(e,t,n){var a=yield S(),r=window.epg.eth_value,o=yield Qt(e.account,r,e.currency,a),l=null!==t&&t>=Jt;l&&(l=yield ln(e.currency,a));var i=yield Pn(mn(mn({},e),{},{lastTxConfirmations:t}),l,n);return mn({paymentStep:o,isOrderPayed:l},i)}))).apply(this,arguments)}function Pn(e,t,n){return In.apply(this,arguments)}function In(){return(In=u()((function*(e,t,n){var{str_payment_complete:a,str_payment_success_label:r,wpj_payment_type:o,order_id:l,payment_id:i}=window.epg;if(t){var s=a;null!==e.lastTxHash&&(s=(0,P.sprintf)(r,e.lastTxHash));var c={message:s,type:"success"};if(window.scrollTo(0,n.current.offsetTop),void 0===o)setTimeout((()=>{location.reload()}),1e4);else{yield ft();var u="/?jb_action=loader_page&oid="+l+"&wpj_payment_id="+i;setTimeout((()=>{location.href=u}),1e4)}return{infoMessage:c}}return{}}))).apply(this,arguments)}function An(e){var t=gn(),n=(0,o.useRef)(null),a=function(){var{decimals_ether:e,disable_ether:t,tokens_supported:n,base_currency_ticker:a}=window.epg,r=[];"no"===t&&r.push({symbol:a,address:ke,rate:1,decimals:e});var o=n.split(",").map((e=>{var t=e.split(":");return t.length<5?{symbol:t[0],address:t[1],rate:t[2]}:{symbol:t[0],address:t[1],rate:t[2],decimals:t[5]}}));return r.concat(o)}(),[l,i]=(0,o.useState)({infoMessage:{message:null,type:"warning"},lastTxHash:null,lastTxConfirmations:null,paymentStep:null,isOrderPayed:!1,account:null,paymentMethod:null,accountDialogOpen:!1,currency:null}),s=function(){var e=u()((function*(e){console.log("changeLastTxHash:",e);var t=yield function(e,t,n,a){return Nn.apply(this,arguments)}(l,e,n);yield dt(e);i(mn(mn(mn({},l),t),{},{lastTxHash:e}))}));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=u()((function*(){var e=yield S(),t=yield Le(l.currency,l.paymentStep,e);if(null!==t){var a=null;switch(l.paymentStep){case"deposit":var{gateway_address:r,erc20_abi:o}=window.epg,c=JSON.parse(o),d=l.currency.address,p=new e.eth.Contract(c,d);a=p.events.Approval({filter:{_owner:l.account,_spender:r}});break;case"payment":var{gateway_address:m,gateway_abi:f,payment_address:g,order_id:v}=window.epg,h=JSON.parse(f),y=(l.currency.address,new e.eth.Contract(h,m));a=y.events.PaymentOccured({filter:{_sellerAddress:g,_orderId:v}})}if(null!==a)return console.log("Subscribing to",t),a.on("data",(a=>{if(console.log("data:",a),a.address.toLowerCase()===t.toLowerCase()){var{gateway_address:r,payment_address:o,order_id:c}=window.epg;if("Approval"!==a.event||a.returnValues[0].toLowerCase()===l.account.toLowerCase()&&a.returnValues[1].toLowerCase()===r.toLowerCase())if("PaymentOccured"!==a.event||a.returnValues[1].toLowerCase()===o.toLowerCase()&&e.utils.toBN(a.returnValues[3]).eq(e.utils.toBN(c))){var{transactionHash:d}=a;(function(){var e=u()((function*(){var e=d,t=yield S(),a={};if(a.lastTxHash=e,null===l.lastTxHash||a.lastTxHash===l.lastTxHash){if(null===l.lastTxConfirmations||l.lastTxConfirmations<Jt){var r=yield xn(a.lastTxHash,t);console.log("useInterval: lastTxConfirmations2:",r),null!==r&&(a.lastTxConfirmations=r)}}else{var o=yield xn(a.lastTxHash,t);console.log("useInterval: lastTxConfirmations2:",o),null!==o?null!==l.lastTxConfirmations&&o>10&&l.lastTxConfirmations<o?(console.log("old tx hash arrived"),a.lastTxHash=l.lastTxHash):a.lastTxConfirmations=o:a.lastTxConfirmations=0}if(a.lastTxHash!==l.lastTxHash)yield s(a.lastTxHash);else if(void 0!==a.lastTxConfirmations&&a.lastTxConfirmations!==l.lastTxConfirmations){var c=yield On(l,a.lastTxConfirmations,n);i(mn(mn(mn({},l),c),{},{lastTxConfirmations:a.lastTxConfirmations}))}}));return function(){return e.apply(this,arguments)}})()()}else console.log("skip PaymentOccured data:",o,c);else console.log("skip Approval data:",l.account,r)}else console.log("skip data for address:",a.address)})).on("changed",(e=>{console.log("changed:",e)})).on("error",(e=>{console.log("error:",e)})),()=>{console.log("Unsubscribing from",t),a.unsubscribe(((e,t)=>{if(e)return console.log(e),void console.log("Failed to unsubscribe!");t?console.log("Successfully unsubscribed!"):console.log("Failed to unsubscribe!")}))};console.log("No event subscription found")}}));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((()=>{c()}),[l.account,l.currency,l.paymentStep]);var d=hn(((e,t)=>{(function(){var n=u()((function*(){var n=yield kn(l,a,e,t);i(mn(mn({},l),n))}));return function(){return n.apply(this,arguments)}})()()}),(()=>{i(mn(mn({},l),{},{accountDialogOpen:!0}))})),f=function(){var e=u()((function*(){var e=null!==l.lastTxHash?l.lastTxHash:yield Yt(l.account);if(null!==e){var t=yield S(),a={};if(a.lastTxHash=e,null===l.lastTxConfirmations||l.lastTxConfirmations<Jt){var r=yield xn(a.lastTxHash,t);console.log("useInterval: lastTxConfirmations2:",r),null!==r&&(a.lastTxConfirmations=r)}if(void 0!==a.lastTxConfirmations&&a.lastTxConfirmations!==l.lastTxConfirmations){var o=yield On(l,a.lastTxConfirmations,n);i(mn(mn(mn({},l),o),{},{lastTxConfirmations:a.lastTxConfirmations}))}}}));return function(){return e.apply(this,arguments)}}();(0,_.Z)((()=>{f()}),5e3);var{infoMessage:g,account:v,paymentMethod:h,currency:y,lastTxHash:b,lastTxConfirmations:x,paymentStep:H,isOrderPayed:k}=l;return r()(dn.Z,{theme:fn},void 0,o.createElement("section",{ref:n,className:"epg-payment-instructions"},r()(Gt,{lastTxHash:b,lastTxConfirmations:x}),r()("div",{className:t.root},void 0,r()(p.Z,{container:!0,justify:"center",className:t.content},void 0,r()(p.Z,{item:!0,xs:12,className:t.row},void 0,r()(m.Z,{className:t.title,variant:"h2"},void 0,window.epg.str_gateway_title_text)),r()(p.Z,{item:!0,xs:12,className:t.row},void 0,function(e){return e.message?r()(w,{message:e.message,type:e.type}):null}(g)),r()(p.Z,{item:!0,xs:12,className:t.row},void 0,!k&&function(e){return null===e?null:r()(A,{paymentMethod:e})}(h)),r()(p.Z,{item:!0,xs:12,className:t.row},void 0,!k&&function(e,t,n,a,o,l,i){return r()(fe,{payment_methods:a,paymentMethod:e,account:t,accountDialogOpen:o,onAccountDialogClose:l,onAccountDialogChange:i,clearPaymentMethod:n})}(h,v,(()=>{console.log("clearPaymentMethodHandler",l);var e=[];(function(){var t=u()((function*(){var t=yield kn(l,a,null,e);i(mn(mn({},l),t))}));return function(){return t.apply(this,arguments)}})()()}),d,l.accountDialogOpen,(e=>{i(mn(mn({},l),{},{accountDialogOpen:!1}))}),(e=>{console.log("handleAccountDialogChange:",e),function(){var t=u()((function*(){var t=[];(yield S()).utils.isAddress(e)||(e=null,console.log("handleAccountDialogChange: isAddress NOT OK"));var n=null;null!==e&&(n="qr",t.push(e));var r=yield kn(l,a,n,t);i(mn(mn(mn({},l),r),{},{accountDialogOpen:!1}))}));return function(){return t.apply(this,arguments)}}()()}))),r()(p.Z,{item:!0,xs:12,className:t.row},void 0,!k&&function(e,t,n,a,o,l,i,s){return null===n?null:r()(bt,{currency:e,account:t,paymentMethod:n,paymentMethods:a,currencies:i,changePaymentCurrency:s,paymentStep:o,changeLastTxHash:l})}(y,v,h,d,H,s,a,(e=>{var t=e.target.value;(console.log("changePaymentCurrencyHandler:",t,l),yn(a,t)!==l.currency)&&function(){var e=u()((function*(){var e=yield Sn(l,a,t);i(mn(mn({},l),e))}));return function(){return e.apply(this,arguments)}}()()}))),r()(p.Z,{item:!0,xs:12},void 0,!k&&function(e,t,n,a,o){if(null===n)return null;if(null===o)return null;if(null===t)return null;var l=!a.filter((e=>e.mnemonic===n))[0].hasWalletAccess;return r()(Rt,{account:e,paymentStep:o,expandedInitial:l,etherAmount:window.epg.eth_value,currency:t})}(v,y,h,d,H))))))}var jn=document.getElementById("ether-and-erc20-tokens-woocommerce-payment-gateway-widget"),Bn=r()(An,{});jn?l.render(r()(An,{}),jn):document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("ether-and-erc20-tokens-woocommerce-payment-gateway-widget");e&&l.render(Bn,e)}))},32574:function(){},61758:function(){}},0,[[97072,303,216]]]);
//# sourceMappingURL=main.ffe34392384e72dd316a.js.map